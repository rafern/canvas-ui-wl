(()=>{var M=Object.create;var b=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var j=s=>b(s,"__esModule",{value:!0});var D=s=>{if(typeof require!="undefined")return require(s);throw new Error('Dynamic require of "'+s+'" is not supported')};var C=(s,t,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of L(t))!I.call(s,e)&&e!=="default"&&b(s,e,{get:()=>t[e],enumerable:!(i=w(t,e))||i.enumerable});return s},y=s=>C(j(b(s!=null?M(V(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var c=y(D("canvas-ui")),g=y(D("gl-matrix")),T=null,f=null,O=null,o=class extends c.Root{static get pointerDriver(){return T===null&&(T=new c.PointerDriver),T}static get keyboardDriver(){return f===null&&(f=new c.DOMKeyboardDriver,f.bindDOMElem(WL.canvas)),f}static get pointerIDs(){return O===null&&(O=new Map),O}static getPointerID(t){let i=o.pointerIDs,e=i.get(t);return typeof e=="undefined"&&(e=o.pointerDriver.registerPointer(),i.set(t,e)),e}constructor(t,i,e,r=new c.Theme,a=.01,h=!0,p=!0){super(e,u=>{WL.canvas.style.cursor=u},r);this.unitsPerPixel=a,this.meshObject=WL.scene.addObject(t),this.meshObject.active=!1,h&&this.registerDriver(o.pointerDriver),p&&this.registerDriver(o.keyboardDriver),this.mesh=this.meshObject.addComponent("mesh"),this.materialClone=i.clone(),this.mesh.material=this.materialClone,this.oldTexSize=[0,0],this._setupMesh(1,0),this.collision=this.meshObject.addComponent("collision",{collider:WL.Collider.Box,extents:[1,1,.01],group:2});let m=this.meshObject.addComponent("cursor-target"),l=new Float32Array(3),v=new Float32Array(3),x=u=>(l.set(u.rayHit.locations[0]),this.meshObject.getTranslationWorld(v),g.vec3.sub(l,l,v),g.vec3.div(l,l,this.meshObject.scalingLocal),[Math.min(Math.max((l[0]+1)/2,0),1),Math.min(Math.max(1-(l[1]+1)/2,0),1)]);h&&(m.addUnHoverFunction((u,n)=>{o.pointerDriver.leavePointer(this,o.getPointerID(n))}),m.addCursorMoveFunction((u,n)=>{o.pointerDriver.movePointer(this,o.getPointerID(n),...x(n))}),m.addCursorDownFunction((u,n)=>{o.pointerDriver.movePointer(this,o.getPointerID(n),...x(n),!0)}),m.addCursorUpFunction((u,n)=>{o.pointerDriver.movePointer(this,o.getPointerID(n),...x(n),!1)})),this.valid=!0}update(){if(!this.valid)return;this.preLayoutUpdate();let t=this.resolveLayout(),[i,e]=this.canvasDimensions;if(t){let[a,h]=this.dimensions;this.meshObject.resetScaling(),this.meshObject.scale([this.unitsPerPixel*a,this.unitsPerPixel*h,.01]),this.collision.extents=[this.meshObject.scalingLocal[0],this.meshObject.scalingLocal[1],.01],this._setupMesh(a/i,1-h/e)}this.postLayoutUpdate();let r=this.paint();if(this.meshObject.active=this.enabled,!!r)if(this.oldTexSize[0]!==i||this.oldTexSize[1]!==e){this.oldTexSize[0]=i,this.oldTexSize[1]=e;let a=this.materialClone;this.texture=new WL.Texture(this.canvas),a.shader==="Flat Opaque Textured"||a.shader==="Flat Transparent Textured"?a.flatTexture=this.texture:a.shader=="Phong Opaque Textured"?a.diffuseTexture=this.texture:console.error("Shader",a.shader,"not supported by WLRoot")}else this.texture.update()}_setVertex(t,i,e,r,a,h,p,m,l,v){t.set([e,r,a,l,v,h,p,m],i*WL.Mesh.VERTEX_FLOAT_SIZE)}_setUV(t,i,e,r){t.set([e,r],i*WL.Mesh.VERTEX_FLOAT_SIZE+WL.Mesh.TEXCOORD.U)}_setupMesh(t,i){let e=new Uint8Array([0,3,1,0,2,3]),r=new Float32Array(4*WL.Mesh.VERTEX_FLOAT_SIZE);this._setVertex(r,0,-1,1,0,0,0,1,0,1),this._setVertex(r,1,1,1,0,0,0,1,t,1),this._setVertex(r,2,-1,-1,0,0,0,1,0,i),this._setVertex(r,3,1,-1,0,0,0,1,t,i),this.mesh.mesh=new WL.Mesh({indexData:e,indexType:WL.MeshIndexType.UnsignedByte,vertexData:r})}};var d=y(D("canvas-ui"));var P=class extends o{constructor(t,i,e=d.defaultVirtualKeyboardTemplate,r=null,a=new d.Theme,h=.01,p=!0){r===null&&(r=o.keyboardDriver),super(t,i,new d.Margin(new d.VirtualKeyboard(r,e)),a,h,p,!1),this.keyboardDriver=r}updateVisibility(){!this.valid||(this.enabled=this.keyboardDriver.getFocusedRoot()!==null)}};WL.registerComponent("virtual-keyboard-ui-root",{material:{type:WL.Type.Material}},{init(){this.root=new P(this.object,this.material),this.forceDisabled=!1},update(s){this.root&&!this.forceDisabled&&(this.root.updateVisibility(),this.root.update())},onActivate(){this.root&&(this.forceDisabled=!1,this.root.enabled=!0)},onDeactivate(){this.root&&(this.forceDisabled=!0,this.root.enabled=!1)}});})();
//# sourceMappingURL=index.esm.js.map
