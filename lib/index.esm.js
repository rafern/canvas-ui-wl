import{Root as y,PointerDriver as g,DOMKeyboardDriver as T,Theme as O}from"canvas-ui";import{vec3 as b}from"gl-matrix";var v=null,m=null,f=null,s=class extends y{static get pointerDriver(){return v===null&&(v=new g),v}static get keyboardDriver(){return m===null&&(m=new T,m.bindDOMElem(WL.canvas)),m}static get pointerIDs(){return f===null&&(f=new Map),f}static getPointerID(r){let i=s.pointerIDs,e=i.get(r);return typeof e=="undefined"&&(e=s.pointerDriver.registerPointer(),i.set(r,e)),e}constructor(r,i,e,t=new O,o=.01,n=!0,d=!0){super(e,l=>{WL.canvas.style.cursor=l},t);this.unitsPerPixel=o,this.meshObject=WL.scene.addObject(r),this.meshObject.active=!1,n&&this.registerDriver(s.pointerDriver),d&&this.registerDriver(s.keyboardDriver),this.mesh=this.meshObject.addComponent("mesh"),this.materialClone=i.clone(),this.mesh.material=this.materialClone,this.oldTexSize=[0,0],this._setupMesh(1,0),this.collision=this.meshObject.addComponent("collision",{collider:WL.Collider.Box,extents:[1,1,.01],group:2});let c=this.meshObject.addComponent("cursor-target"),h=new Float32Array(3),u=new Float32Array(3),p=l=>(h.set(l.rayHit.locations[0]),this.meshObject.getTranslationWorld(u),b.sub(h,h,u),b.div(h,h,this.meshObject.scalingLocal),[Math.min(Math.max((h[0]+1)/2,0),1),Math.min(Math.max(1-(h[1]+1)/2,0),1)]);n&&(c.addUnHoverFunction((l,a)=>{s.pointerDriver.leavePointer(this,s.getPointerID(a))}),c.addCursorMoveFunction((l,a)=>{s.pointerDriver.movePointer(this,s.getPointerID(a),...p(a))}),c.addCursorDownFunction((l,a)=>{s.pointerDriver.movePointer(this,s.getPointerID(a),...p(a),!0)}),c.addCursorUpFunction((l,a)=>{s.pointerDriver.movePointer(this,s.getPointerID(a),...p(a),!1)})),this.valid=!0}update(){if(!this.valid)return;this.preLayoutUpdate();let r=this.resolveLayout(),[i,e]=this.canvasDimensions;if(r){let[o,n]=this.dimensions;this.meshObject.resetScaling(),this.meshObject.scale([this.unitsPerPixel*o,this.unitsPerPixel*n,.01]),this.collision.extents=[this.meshObject.scalingLocal[0],this.meshObject.scalingLocal[1],.01],this._setupMesh(o/i,1-n/e)}this.postLayoutUpdate();let t=this.paint();if(this.meshObject.active=this.enabled,!!t)if(this.oldTexSize[0]!==i||this.oldTexSize[1]!==e){this.oldTexSize[0]=i,this.oldTexSize[1]=e;let o=this.materialClone;this.texture=new WL.Texture(this.canvas),o.shader==="Flat Opaque Textured"||o.shader==="Flat Transparent Textured"?o.flatTexture=this.texture:o.shader=="Phong Opaque Textured"?o.diffuseTexture=this.texture:console.error("Shader",o.shader,"not supported by WLRoot")}else this.texture.update()}_setVertex(r,i,e,t,o,n,d,c,h,u){r.set([e,t,o,h,u,n,d,c],i*WL.Mesh.VERTEX_FLOAT_SIZE)}_setUV(r,i,e,t){r.set([e,t],i*WL.Mesh.VERTEX_FLOAT_SIZE+WL.Mesh.TEXCOORD.U)}_setupMesh(r,i){let e=new Uint8Array([0,3,1,0,2,3]),t=new Float32Array(4*WL.Mesh.VERTEX_FLOAT_SIZE);this._setVertex(t,0,-1,1,0,0,0,1,0,1),this._setVertex(t,1,1,1,0,0,0,1,r,1),this._setVertex(t,2,-1,-1,0,0,0,1,0,i),this._setVertex(t,3,1,-1,0,0,0,1,r,i),this.mesh.mesh=new WL.Mesh({indexData:e,indexType:WL.MeshIndexType.UnsignedByte,vertexData:t})}};import{VirtualKeyboard as P,defaultVirtualKeyboardTemplate as M,Theme as w,Margin as L}from"canvas-ui";var x=class extends s{constructor(r,i,e=M,t=null,o=new w,n=.01,d=!0){t===null&&(t=s.keyboardDriver),super(r,i,new L(new P(t,e)),o,n,d,!1),this.keyboardDriver=t}updateVisibility(){!this.valid||(this.enabled=this.keyboardDriver.getFocusedRoot()!==null)}};WL.registerComponent("virtual-keyboard-ui-root",{material:{type:WL.Type.Material}},{init(){this.root=new x(this.object,this.material),this.forceDisabled=!1},update(D){this.root&&!this.forceDisabled&&(this.root.updateVisibility(),this.root.update())},onActivate(){this.root&&(this.forceDisabled=!1,this.root.enabled=!0)},onDeactivate(){this.root&&(this.forceDisabled=!0,this.root.enabled=!1)}});export{s as WLRoot,x as WLVirtualKeyboardRoot};
//# sourceMappingURL=index.esm.js.map
